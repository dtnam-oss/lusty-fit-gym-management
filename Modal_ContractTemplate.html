<div id="contract-template-modal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3 id="contract-template-modal-title">Thêm mẫu hợp đồng</h3>
            <span class="close" onclick="closeContractTemplateModal()">&times;</span>
        </div>

        <div class="modal-body">
            <form id="contract-template-form" onsubmit="return false;">
                <input type="hidden" id="template-row-number">

                <div class="form-row">
                    <div class="form-group col-md-8">
                        <label for="template-name">Tên mẫu <span class="required">*</span></label>
                        <input type="text"
                               id="template-name"
                               class="form-control"
                               placeholder="VD: Mẫu hợp đồng thành viên phiên bản 2.0"
                               required>
                    </div>

                    <div class="form-group col-md-4">
                        <label for="template-type">Loại mẫu <span class="required">*</span></label>
                        <select id="template-type" class="form-control" required>
                            <option value="">-- Chọn loại --</option>
                            <option value="Hội viên">Hội viên</option>
                            <option value="PT">PT</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-12">
                        <label for="template-description">Mô tả</label>
                        <textarea id="template-description"
                                  class="form-control"
                                  rows="3"
                                  placeholder="Mô tả về mẫu hợp đồng này..."></textarea>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-12">
                        <label for="template-status">Trạng thái <span class="required">*</span></label>
                        <select id="template-status" class="form-control" required>
                            <option value="Không sử dụng">Không sử dụng</option>
                            <option value="Đang sử dụng">Đang sử dụng</option>
                        </select>
                        <small class="form-text text-muted">
                            Lưu ý: Chỉ có 1 mẫu "Đang sử dụng" cho mỗi loại. Khi kích hoạt mẫu này, mẫu cũ sẽ tự động bị vô hiệu hóa.
                        </small>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-12">
                        <label for="template-html-content">
                            Nội dung HTML <span class="required">*</span>
                            <button type="button"
                                    class="btn btn-sm btn-info"
                                    onclick="toggleHTMLEditor()"
                                    style="margin-left: 10px;">
                                Chế độ soạn thảo
                            </button>
                            <button type="button"
                                    class="btn btn-sm btn-secondary"
                                    onclick="previewHTMLContent()"
                                    style="margin-left: 10px;">
                                Xem trước
                            </button>
                        </label>

                        <!-- Code editor for HTML -->
                        <div id="html-code-editor" style="display: block;">
                            <textarea id="template-html-content"
                                      class="form-control code-editor"
                                      rows="20"
                                      placeholder="Nhập nội dung HTML của mẫu hợp đồng..."
                                      required></textarea>
                        </div>

                        <!-- Visual editor (optional - could use a rich text editor library) -->
                        <div id="html-visual-editor" style="display: none;">
                            <div id="visual-editor-container" class="visual-editor">
                                <!-- This could integrate a WYSIWYG editor -->
                                <p class="text-muted">Chế độ soạn thảo trực quan (đang phát triển)</p>
                            </div>
                        </div>

                        <small class="form-text text-muted">
                            Hỗ trợ template variables: <code>&lt;?= customer['Họ và Tên'] ?&gt;</code>, <code>&lt;?= contract.id ?&gt;</code>, etc.
                        </small>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-12">
                        <div class="template-variables-help">
                            <strong>Các biến có thể sử dụng trong template:</strong>
                            <ul>
                                <li><code>&lt;?= customer['Họ và Tên'] ?&gt;</code> - Tên khách hàng</li>
                                <li><code>&lt;?= customer['CCCD'] ?&gt;</code> - Số CCCD</li>
                                <li><code>&lt;?= customer['Địa chỉ'] ?&gt;</code> - Địa chỉ</li>
                                <li><code>&lt;?= customer['Email'] ?&gt;</code> - Email</li>
                                <li><code>&lt;?= customer['Số điện thoại'] ?&gt;</code> - Số điện thoại</li>
                                <li><code>&lt;?= customer['Giới tính'] ?&gt;</code> - Giới tính</li>
                                <li><code>&lt;?= customer['Ngày sinh'] ?&gt;</code> - Ngày sinh</li>
                                <li><code>&lt;?= contract.id ?&gt;</code> - Số hợp đồng</li>
                                <li><code>&lt;?= contract.customerId ?&gt;</code> - Mã khách hàng</li>
                                <li><code>&lt;?= contract.packageName ?&gt;</code> - Tên gói</li>
                                <li><code>&lt;?= contract.totalAmount ?&gt;</code> - Tổng tiền</li>
                                <li><code>&lt;?= contract.startDate ?&gt;</code> - Ngày bắt đầu</li>
                                <li><code>&lt;?= contract.endDate ?&gt;</code> - Ngày kết thúc</li>
                                <li><code>&lt;?= generatedDate ?&gt;</code> - Ngày tạo hợp đồng</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeContractTemplateModal()">
                Hủy
            </button>
            <button type="button" class="btn btn-primary" onclick="saveContractTemplate()">
                Lưu mẫu
            </button>
        </div>
    </div>
</div>

<!-- Preview Modal -->
<div id="template-preview-modal" class="modal">
    <div class="modal-content modal-fullscreen">
        <div class="modal-header">
            <h3>Xem trước mẫu hợp đồng</h3>
            <span class="close" onclick="closeTemplatePreviewModal()">&times;</span>
        </div>

        <div class="modal-body">
            <div id="template-preview-content" class="preview-iframe-container">
                <!-- Preview content will be injected here -->
            </div>
        </div>

        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeTemplatePreviewModal()">
                Đóng
            </button>
        </div>
    </div>
</div>

<style>
    .modal-large {
        max-width: 90%;
        width: 1200px;
    }

    .modal-fullscreen {
        max-width: 95%;
        width: 95%;
        height: 90vh;
    }

    .modal-fullscreen .modal-body {
        max-height: calc(90vh - 150px);
        overflow-y: auto;
    }

    .code-editor {
        font-family: 'Courier New', monospace;
        font-size: 13px;
        line-height: 1.5;
        background: #f5f5f5;
        border: 1px solid #ddd;
        padding: 10px;
    }

    .template-variables-help {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        border: 1px solid #dee2e6;
        margin-top: 10px;
    }

    .template-variables-help code {
        background: #e9ecef;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 12px;
        color: #d63384;
    }

    .template-variables-help ul {
        margin: 10px 0 0 20px;
        font-size: 13px;
    }

    .template-variables-help li {
        margin-bottom: 5px;
    }

    .visual-editor {
        border: 1px solid #ddd;
        padding: 20px;
        min-height: 400px;
        background: white;
    }

    .preview-iframe-container {
        width: 100%;
        height: 100%;
        border: 1px solid #ddd;
        background: white;
        overflow: auto;
    }

    .preview-iframe-container iframe {
        width: 100%;
        height: 100%;
        border: none;
    }

    .required {
        color: red;
    }

    .form-row {
        display: flex;
        flex-wrap: wrap;
        margin-right: -15px;
        margin-left: -15px;
    }

    .col-md-4 {
        flex: 0 0 33.333333%;
        max-width: 33.333333%;
        padding-right: 15px;
        padding-left: 15px;
    }

    .col-md-8 {
        flex: 0 0 66.666667%;
        max-width: 66.666667%;
        padding-right: 15px;
        padding-left: 15px;
    }

    .col-md-12 {
        flex: 0 0 100%;
        max-width: 100%;
        padding-right: 15px;
        padding-left: 15px;
    }

    .btn-sm {
        padding: 4px 8px;
        font-size: 12px;
    }

    .text-muted {
        color: #6c757d;
    }
</style>
