<div id="contractModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="contractModalTitle">Tạo Hợp Đồng Mới</h2>
            <span class="close-button" onclick="closeModal('contractModal')">&times;</span>
        </div>
        <form id="contractForm" onsubmit="handleContractFormSubmit(event)">
            <input type="hidden" id="contractRowNumber">
            <input type="hidden" id="contractId">
            <div class="form-grid">
                <!-- THAY ĐỔI TỪ RADIO SANG BUTTON GROUP -->
                <div class="form-group full-width">
                    <label>Loại hợp đồng:</label>
                    <div class="button-group" id="contractTypeSelector">
                        <button type="button" class="btn-segment active" data-type="Hội viên">Hội viên</button>
                        <button type="button" class="btn-segment" data-type="PT">PT</button>
                    </div>
                </div>
                <!-- KẾT THÚC THAY ĐỔI -->

                <div id="customer-selection-area" class="form-group full-width">
                    <label for="contractCustomerSelect">Chọn Hội Viên</label>
                    <select id="contractCustomerSelect" onchange="handleCustomerSelectionChange()" required></select>
                </div>
                <div id="pt-selection-area" class="form-group full-width" style="display:none;">
                    <label for="contractPTSelect">Chọn PT</label>
                    <select id="contractPTSelect" onchange="handlePTSelectionChange()"></select>
                </div>
                
                <!-- Hidden fields to store selected person info -->
                <input type="hidden" id="contractPersonPhone">
                <input type="hidden" id="contractPersonEmail">
                <input type="hidden" id="contractPersonCCCD">
                <input type="hidden" id="contractPersonAddress">
                <input type="hidden" id="contractPersonDOB">
                <input type="hidden" id="contractPersonGender">
                <div class="form-group full-width">
                    <label for="priceListSelect">Chọn Bảng Giá (Gói Tập)</label>
                    <select id="priceListSelect" onchange="handlePriceListChange()" required>
                        <option value="">-- Vui lòng chọn loại hợp đồng --</option>
                    </select>
                </div>
                <div class="form-group"><label for="contractDonGia">Đơn giá</label><input type="number" id="contractDonGia" readonly></div>
                <div class="form-group"><label for="contractVAT">VAT (%)</label><input type="number" id="contractVAT" readonly></div>
                <div class="form-group"><label for="contractDonGiaVAT">Đơn giá sau VAT</label><input type="number" id="contractDonGiaVAT" readonly></div>
                <div class="form-group"><label for="contractChietKhau">Chiết khấu</label><input type="text" id="contractChietKhau" readonly></div>
                <div class="form-group"><label for="contractSoLuong">Số lượng</label><input type="number" id="contractSoLuong" min="1" value="1" onchange="handleQuantityChange()" required></div>
                <div class="form-group"><label for="contractTongThanhToan">Tổng thanh toán</label><input type="number" id="contractTongThanhToan" readonly></div>
                <div class="form-group"><label for="contractThoiHan">Thời hạn (ngày)</label><input type="number" id="contractThoiHan" readonly></div>
                <div class="form-group"><label for="contractStartDate">Thời gian bắt đầu</label><input type="date" id="contractStartDate" onchange="calculateEndDate()" required></div>
                <div class="form-group"><label for="contractEndDate">Thời gian kết thúc</label><input type="date" id="contractEndDate" readonly></div>
                <div class="form-group"><label for="contractStatus">Tình trạng</label><select id="contractStatus"><option value="Đang hiệu lực">Đang hiệu lực</option><option value="Sắp diễn ra">Sắp diễn ra</option><option value="Đã hết hạn">Đã hết hạn</option></select></div>
                
                <!-- Dynamic member fields will be inserted here -->
                <div id="dynamicMembersContainer" class="form-group full-width"></div>
            </div>
            <button type="submit" class="btn-primary">Lưu Hợp Đồng</button>
        </form>
    </div>
</div>